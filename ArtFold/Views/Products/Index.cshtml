@model PagedList.IPagedList<ArtFold.Models.Product>
@using PagedList.Mvc;

<head>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/ArtFold.styles.css" asp-append-version="true" />

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;900&display=swap" rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="~/lib/ogani-master/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="~/lib/ogani-master/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="~/lib/ogani-master/css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="~/lib/ogani-master/css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="~/lib/ogani-master/css/jquery-ui.min.css" type="text/css">
    <link rel="stylesheet" href="~/lib/ogani-master/css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="~/lib/ogani-master/css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="~/lib/ogani-master/css/style.css" type="text/css">





    <style>
        .breadcrumb-section {
            position: relative;
            flex-wrap: wrap;
        }

        .breadcrumb-title {
            position: absolute;
        }

        #lastestProduct {
            display: block !important;
            visibility: visible !important;
        }

        .product__pagination{
            display: flex;
            justify-content: center;
        }

        .pagination li{
            padding: 0 15px;
        }

        .page-link {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .owl-nav {
            display: none;
        }

        #addCartBtn{
            border: none;
        }

        .popup {
            position: fixed;
            top: 20px;
            right: -300px; /* Ban đầu đặt ngoài màn hình */
            width: 250px;
            padding: 15px;
            background-color: #4CAF50; /* Màu đỏ cho thông báo lỗi */
            color: white;
            font-size: 16px;
            border-radius: 4px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: right 0.5s ease-in-out; /* Thêm transition cho hiệu ứng trượt */
        }

            /* Khi pop-up hiển thị */
            .popup.show {
                right: 20px; /* Hiện tại vị trí cách mép phải màn hình 20px */
            }

        #successPopup {
            background-color: #4CAF50; /* Màu xanh lá cây cho thông báo thành công */
        }
    </style>
</head>

<body>
    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>


    <!-- Breadcrumb Section Begin -->
    <section class="breadcrumb-section">
        <img src="~/lib/ogani-master/img/breadcrumb.jpg" style="height: 130px; object-fit:cover" />
        <div class="container breadcrumb-title">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <div class="breadcrumb__text">
                        <h2>ArtFold Shop</h2>
                        <div class="breadcrumb__option">
                            <a asp-controller="Home" asp-action="Index">Home</a>
                            <span>Shop</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Breadcrumb Section End -->
    <!-- Product Section Begin -->
    <section class="product spad">
        <div class="container">
            <div class="row">
                <div>
                    <div id="salesOff" class="product__discount">

                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-3 col-md-5">
                        <div class="sidebar">
                            <div class="sidebar__item">
                                <h4>Department</h4>
                                <ul>
                                    <li><a href="#">Anime</a></li>
                                    <li><a href="#">Vehicle</a></li>
                                    <li><a href="#">Marvel</a></li>
                                    <li><a href="#">Architecture</a></li>
                                </ul>
                            </div>
                            <div class="sidebar__item">
                                <h4>Price</h4>
                                <div class="price-range-wrap">
                                    <div class="price-range ui-slider ui-corner-all ui-slider-horizontal ui-widget ui-widget-content"
                                         data-min="10" data-max="540">
                                        <div class="ui-slider-range ui-corner-all ui-widget-header"></div>
                                        <span tabindex="0" class="ui-slider-handle ui-corner-all ui-state-default"></span>
                                        <span tabindex="0" class="ui-slider-handle ui-corner-all ui-state-default"></span>
                                    </div>
                                    <div class="range-slider">
                                        <div class="price-input">
                                            <input type="text" id="minamount">
                                            <input type="text" id="maxamount">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="lastestProduct"></div>
                        </div>
                    </div>

                    <div class="col-lg-9 col-md-7">

                        <div class="filter__item">
                            <div class="row">
                                <div class="col-lg-8 col-md-9">
                                    <div class="filter__sort">
                                        <span>Sort By</span>
                                        <select>
                                            <option value="0">Default</option>
                                            <option value="0">Default</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col-lg-4 col-md-3">
                                    <div class="filter__option">
                                        <span class="icon_grid-2x2"></span>
                                        <span class="icon_ul"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">

                            @foreach (var product in Model)
                            {
                                <div asp-route-id="@product.ProductID" asp-controller="Products" asp-action="Details" class="col-lg-4 col-md-6 col-sm-6">
                                    <div class="product__item">

                                        <div class="product__item__pic">
                                            <img src="@product.ImgUrl" />
                                            <ul class="product__item__pic__hover">
                                                <li><button type="button" id="addCartBtn" class="btn btn-link" data-product-id="@product.ProductID"><a><i class="fa fa-shopping-cart"></i></a></button></li>
                                            </ul>

                                            <div id="successPopup" class="popup">
                                                <span id="popupMessage">Add To Cart Successfully</span>
                                            </div>
                                        </div>
                                        <div class="product__item__text">
                                            <h6><a asp-route-id="@product.ProductID" asp-controller="Products" asp-action="Details">@product.Name</a></h6>
                                            <h5>@(product.Price.ToString("N0").Replace(",", ".") + " đ")</h5>
                                        </div>
                                    </div>
                                </div>
                            }

                            <div class="product__pagination">
                                <nav>
                                    <ul class="pagination">
                                        @if (Model.HasPreviousPage)
                                        {
                                            <li class="page-item">
                                                <a class="page-link" asp-action="Index" asp-route-page="@(Model.PageNumber - 1)" style="display: flex;
                                                                                                                                justify-content: center;
                                                                                                                                   align-items: center;">
                                                    <i class="fa fa-long-arrow-left"></i>
                                                </a>
                                            </li>
                                        }
                                        else
                                        {
                                            <li class="page-item disabled">
                                                <a class="page-link" style="display: flex;
                                                                                                                                justify-content: center;
                                                                                                                                align-items: center;"><i class="fa fa-long-arrow-left"></i></a>
                                            </li>
                                        }

                                        @for (var i = 1; i <= Model.PageCount; i++)
                                        {
                                            <li class="@(i == Model.PageNumber ? "page-item active" : "page-item")">
                                                <a class="page-link" asp-action="Index" asp-route-page="@i" style="display: flex;
                                                                                                                                justify-content: center;
                                                                                                                                   align-items: center;">
                                                    @i
                                                </a>
                                            </li>
                                        }

                                        @if (Model.HasNextPage)
                                        {
                                            <li class="page-item">
                                                <a class="page-link" asp-action="Index" asp-route-page="@(Model.PageNumber + 1)" style="display: flex;
                                                                                                                                justify-content: center;
                                                                                                                                align-items: center;">
                                                    <i class="fa fa-long-arrow-right"></i>
                                                </a>
                                            </li>
                                        }
                                        else
                                        {
                                            <li class="page-item disabled">
                                                <a class="page-link" style="display: flex;
                                                                                                                                justify-content: center;
                                                                                                                                align-items: center;">
                                                    <i class="fa fa-long-arrow-right"></i>
                                                </a>
                                            </li>

                                        }
                                    </ul>
                                </nav>
                            </div>

                        </div>



                    </div>
                </div>
                
            </div>
        </div>
    </section>
    <!-- Product Section End -->



    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="~/lib/ogani-master/js/jquery-3.3.1.min.js"></script>
    <script src="~/lib/ogani-master/js/bootstrap.min.js"></script>
    <script src="~/lib/ogani-master/js/jquery.nice-select.min.js"></script>
    <script src="~/lib/ogani-master/js/jquery-ui.min.js"></script>
    <script src="~/lib/ogani-master/js/jquery.slicknav.js"></script>
    <script src="~/lib/ogani-master/js/mixitup.min.js"></script>
    <script src="~/lib/ogani-master/js/owl.carousel.min.js"></script>
    <script src="~/lib/ogani-master/js/main.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>

</body>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}


<script>
    $(document).ready(function () {
        $.ajax({
            url: '@Url.Action("GetLatestProduct", "Products")',
            type: 'GET',
            success: function (data) {
                $('#lastestProduct').html(data);

                $('.latest-product__slider').owlCarousel({
                    loop: true,
                    margin: 10,
                    nav: true,
                    items: 1,
                    autoplay: true,
                    autoplayTimeout: 3000,
                    autoplayHoverPause: true,
                });
            },
            error: function () {
                alert('Có lỗi xảy ra khi tải sản phẩm.');
            }
        });

        $.ajax({
            url: '@Url.Action("SalesOffProducts", "Products")',
            type: 'GET',
            success: function (data) {
                $('#salesOff').html(data);

                $('.product__discount__slider ').owlCarousel({
                    loop: true,
                    margin: 10,
                    nav: true,
                    items: 3,
                    autoplay: true,                
                    autoplayTimeout: 3000,          
                    autoplayHoverPause: true,
                    onInitialized: function () {
                        $('.owl-nav').addClass('disabled'); 
                    }
                });
            },
            error: function () {
                alert('Có lỗi xảy ra khi tải sản phẩm.');
            }
        });

        $('#addCartBtn').on('click', function () {
            var quantity = 1;
            var productId = $(this).data('product-id');
            $.ajax({
                url: '@Url.Action("AddToCart", "Carts")', // Đường dẫn tới action
                type: 'POST',
                data: {
                    productId: productId,
                    quantity: quantity
                },
                success: function (response) {
                    if (response.success) {
                        var successPopup = $('#successPopup');
                        successPopup.addClass('show');

                        // Ẩn popup sau 2 giây
                        setTimeout(function () {
                            successPopup.removeClass('show');
                        }, 2000);
                    } else {
                        alert(response.message);
                    }
                },
                error: function () {
                    alert('An error occurred while adding the product to the cart.');
                }
            });
            
        });



    });
</script>